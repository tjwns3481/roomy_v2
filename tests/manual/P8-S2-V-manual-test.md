# P8-S2-V 게스트 뷰어 연결점 검증 - 수동 테스트 가이드

## 테스트 목적
게스트 뷰어 화면이 백엔드 리소스(guidebook, branding, upsell, chatbot) API를 올바르게 소비하는지 수동으로 검증합니다.

## 사전 준비

### 1. 테스트 가이드북 생성
```bash
# 1. 호스트로 로그인
# 2. 대시보드에서 "새 가이드북" 클릭
# 3. 다음 정보 입력:
- 제목: "게스트 뷰어 테스트"
- 슬러그: "guest-viewer-test"
- 테마: Modern

# 4. 에디터에서 블록 추가:
- Hero 블록: 이미지 + 제목 + 부제목
- Quick Info 블록: 체크인/체크아웃 시간
- Amenities 블록: WiFi, 주차장, 에어컨
- Rules 블록: 금연, 반려동물 금지
- Map 블록: 숙소 위치

# 5. 상태를 "Published"로 변경
```

### 2. Pro 플랜으로 업그레이드 (브랜딩 테스트용)
```bash
# Settings → Subscription → Upgrade to Pro
```

### 3. Business 플랜으로 업그레이드 (Upsell 테스트용)
```bash
# Settings → Subscription → Upgrade to Business
```

---

## 검증 항목

### ✅ 1. Guidebook 데이터 → UI 렌더링

#### 테스트 시나리오
1. 브라우저에서 `/g/guest-viewer-test` 접근
2. 모든 블록이 순서대로 표시되는지 확인

#### 검증 체크리스트
- [ ] Hero 블록이 풀스크린으로 표시됨
- [ ] Quick Info 블록에 체크인/체크아웃 시간 표시
- [ ] Amenities 블록에 아이콘과 함께 편의시설 표시
- [ ] Rules 블록에 규칙 목록 표시
- [ ] Map 블록에 지도가 렌더링됨
- [ ] 모든 블록이 모바일 반응형으로 잘 보임

#### 예상 결과
```
✓ 모든 블록이 AirBnB 스타일로 렌더링됨
✓ 블록 순서가 에디터 설정대로 표시됨
✓ 숨김 처리된 블록은 표시되지 않음
```

---

### ✅ 2. Branding 데이터 → 로고/색상 적용

#### 테스트 시나리오
1. 에디터에서 "브랜딩" 탭 클릭
2. 다음 설정 적용:
   - 로고 업로드: `test-logo.png`
   - Primary Color: `#FF385C` (AirBnB Red)
   - Secondary Color: `#00A699` (AirBnB Teal)
   - 폰트: `Inter`
3. "저장" 클릭
4. 게스트 뷰어 페이지 새로고침

#### 검증 체크리스트
- [ ] 헤더에 업로드한 로고가 표시됨
- [ ] Primary Color가 버튼, 링크에 적용됨
- [ ] Secondary Color가 강조 요소에 적용됨
- [ ] 폰트가 전체 페이지에 적용됨
- [ ] Custom CSS가 적용됨 (설정한 경우)

#### 예상 결과
```
✓ 브랜딩 설정이 실시간으로 반영됨
✓ 로고 이미지가 고해상도로 표시됨
✓ 색상이 일관되게 적용됨
```

#### API 응답 확인
```bash
# 개발자 도구 → Network 탭
GET /api/guidebooks/[id]/branding
Status: 200
Response:
{
  "data": {
    "logo_url": "https://...",
    "primary_color": "#FF385C",
    "secondary_color": "#00A699",
    "font_family": "Inter"
  }
}
```

---

### ✅ 3. Upsell 아이템 → Upsell 위젯 표시

#### 테스트 시나리오
1. 에디터에서 "Upsell" 탭 클릭
2. 다음 아이템 추가:
   - **조식 추가**: ₩15,000, "건강한 아침 식사"
   - **레이트 체크아웃**: ₩30,000, "오후 3시까지 여유롭게"
   - **공항 픽업**: ₩50,000, "편안한 이동"
3. 모든 아이템을 "활성화" 상태로 설정
4. 게스트 뷰어 페이지 새로고침

#### 검증 체크리스트
- [ ] "추가 서비스" 섹션이 표시됨
- [ ] 3개의 카드가 수평 스크롤로 나열됨
- [ ] 각 카드에 제목, 설명, 가격이 표시됨
- [ ] 이미지가 설정된 경우 이미지 표시
- [ ] 카드 클릭 시 상세 모달이 열림
- [ ] 모달에서 "요청하기" 폼 작성 가능

#### 예상 결과
```
✓ Upsell 위젯이 AirBnB 캐러셀 스타일로 표시됨
✓ 비활성화된 아이템은 표시되지 않음
✓ Business 플랜이 아닌 경우 위젯이 표시되지 않음
```

#### 요청 제출 테스트
1. "조식 추가" 카드 클릭
2. 모달에서 정보 입력:
   - 이름: "홍길동"
   - 연락처: "010-1234-5678"
   - 메시지: "조식 2인 추가 부탁드립니다"
3. "요청하기" 버튼 클릭
4. 성공 메시지 확인

#### API 응답 확인
```bash
# 아이템 목록 조회
GET /api/guidebooks/[id]/upsell/items
Status: 200
Response:
{
  "items": [
    {
      "id": "...",
      "title": "조식 추가",
      "price": 15000,
      "is_active": true
    },
    ...
  ],
  "total": 3
}

# 요청 제출
POST /api/guidebooks/[id]/upsell/requests
Status: 201
Response:
{
  "request": {
    "id": "...",
    "status": "pending",
    "guest_name": "홍길동"
  }
}
```

---

### ✅ 4. Chatbot API → 챗봇 위젯 동작

#### 테스트 시나리오
1. 게스트 뷰어 페이지 하단 우측의 챗봇 버튼 클릭
2. 채팅 위젯이 열리는 것 확인
3. 환영 메시지 확인
4. 다음 질문들을 순서대로 입력:
   - "체크인 시간은?"
   - "와이파이 비밀번호는?"
   - "주변 맛집 추천해줘"

#### 검증 체크리스트
- [ ] 챗봇 버튼에 초록색 활성 표시
- [ ] 버튼 클릭 시 위젯이 슬라이드 업으로 열림
- [ ] 환영 메시지가 표시됨
- [ ] 자주 묻는 질문(Quick Questions) 버튼이 표시됨
- [ ] 질문 입력 후 전송 시 로딩 인디케이터 표시
- [ ] AI 답변이 마크다운으로 렌더링됨
- [ ] 답변에 피드백 버튼(👍/👎)이 표시됨
- [ ] 최소화 버튼 동작 확인
- [ ] 닫기 버튼 동작 확인

#### 예상 결과
```
✓ 챗봇이 Touch Stay 스타일로 동작함
✓ 답변이 3초 이내에 표시됨
✓ 답변이 가이드북 콘텐츠 기반으로 생성됨
✓ 소스 블록이 표시됨 (예: quick_info, rules)
```

#### API 응답 확인
```bash
# 질문 전송
POST /api/chatbot
Body:
{
  "guidebook_id": "...",
  "session_id": "...",
  "question": "체크인 시간은?"
}

Status: 201
Response:
{
  "id": "log-123",
  "answer": "체크인 시간은 오후 2시(14:00)입니다.",
  "created_at": "2024-01-29T10:00:00Z",
  "sources": ["quick_info", "rules"]
}
```

---

### ✅ 5. Chatbot 피드백 → 로그 업데이트

#### 테스트 시나리오
1. 챗봇에서 질문하고 답변 받기
2. 답변 하단의 👍 버튼 클릭
3. 피드백이 전송되었다는 시각적 피드백 확인
4. 다른 질문 후 👎 버튼 클릭

#### 검증 체크리스트
- [ ] 👍 버튼 클릭 시 버튼 색상 변경
- [ ] 👎 버튼 클릭 시 버튼 색상 변경
- [ ] 피드백 전송 실패 시 에러 메시지 표시
- [ ] 한 번 피드백을 보낸 메시지는 버튼 비활성화

#### 예상 결과
```
✓ 피드백이 즉시 서버에 전송됨
✓ 피드백 상태가 UI에 반영됨
✓ 호스트 대시보드에서 피드백 통계 확인 가능
```

#### API 응답 확인
```bash
PATCH /api/chatbot/feedback/[id]
Body:
{
  "feedback": "helpful"  # or "not_helpful"
}

Status: 200
Response:
{
  "success": true,
  "message": "피드백이 저장되었습니다"
}
```

---

### ✅ 6. 통합 시나리오 - 완전한 게스트 여정

#### 시나리오: 게스트가 가이드북을 처음 접근하는 전체 흐름

1. **QR 코드 스캔** → `/g/guest-viewer-test` 접근
2. **히어로 이미지 확인** → 숙소 첫 인상
3. **Quick Info 확인** → 체크인/체크아웃 시간
4. **Amenities 확인** → WiFi, 주차장 정보
5. **스크롤 다운** → Upsell 위젯 표시
6. **"조식 추가" 카드 클릭** → 상세 모달 확인
7. **요청 폼 작성 및 제출** → 성공 메시지
8. **챗봇 버튼 클릭** → 위젯 열기
9. **"주변 맛집은?" 질문** → AI 답변 수신
10. **👍 피드백 전송** → 피드백 UI 반영

#### 검증 포인트
- [ ] 전체 흐름이 끊김없이 진행됨
- [ ] 모든 API 호출이 성공함
- [ ] 로딩 상태가 적절히 표시됨
- [ ] 에러가 발생하지 않음
- [ ] 모바일 디바이스에서도 동일하게 동작함

---

## 에러 케이스 테스트

### 1. 존재하지 않는 가이드북
```
URL: /g/non-existent-slug
예상: 404 페이지 표시
```

### 2. 비공개 가이드북
```
URL: /g/draft-guidebook
예상: "비공개 가이드북입니다" 메시지
```

### 3. 챗봇 사용량 초과 (Free 플랜)
```
질문 50회 이상 전송
예상: "이번 달 챗봇 사용 한도를 초과했습니다" (429 에러)
```

### 4. Upsell 위젯 (Pro 플랜)
```
Pro 플랜에서 게스트 뷰어 접근
예상: Upsell 위젯이 표시되지 않음 (Business 전용)
```

### 5. 네트워크 오류
```
개발자 도구 → Network 탭 → Offline 모드
예상: 적절한 에러 메시지 표시
```

---

## 성능 테스트

### 1. 초기 로딩 시간
```
목표: 3초 이내에 첫 콘텐츠 표시 (LCP)
측정: Lighthouse 또는 PageSpeed Insights
```

### 2. 챗봇 응답 시간
```
목표: 3초 이내에 답변 표시
측정: Network 탭에서 /api/chatbot 응답 시간 확인
```

### 3. 이미지 로딩
```
목표: 이미지 lazy loading으로 스크롤 시 로드
측정: Network 탭에서 이미지 요청 타이밍 확인
```

---

## 접근성 테스트

### 키보드 네비게이션
- [ ] Tab 키로 모든 인터랙티브 요소 접근 가능
- [ ] Enter/Space 키로 버튼 클릭 가능
- [ ] Esc 키로 모달 닫기 가능

### 스크린 리더
- [ ] 모든 이미지에 alt 텍스트 존재
- [ ] 버튼에 aria-label 존재
- [ ] 로딩 상태에 aria-live 영역 존재

### 색상 대비
- [ ] WCAG AA 기준 충족 (최소 4.5:1)
- [ ] 텍스트가 배경과 명확히 구분됨

---

## 모바일 테스트

### iOS Safari
- [ ] 모든 기능 정상 동작
- [ ] 터치 제스처 지원
- [ ] 안전 영역(Safe Area) 고려

### Android Chrome
- [ ] 모든 기능 정상 동작
- [ ] 하단 네비게이션 바 고려

### 반응형 테스트
- [ ] 320px (iPhone SE) 에서 정상 표시
- [ ] 375px (iPhone 12) 에서 정상 표시
- [ ] 768px (iPad) 에서 정상 표시
- [ ] 1024px 이상 (Desktop) 에서 정상 표시

---

## 브라우저 호환성

### Desktop
- [ ] Chrome (최신)
- [ ] Firefox (최신)
- [ ] Safari (최신)
- [ ] Edge (최신)

### Mobile
- [ ] iOS Safari (14+)
- [ ] Android Chrome (90+)

---

## 최종 체크리스트

### 기능 검증
- [ ] 모든 블록 타입이 정상 렌더링됨
- [ ] 브랜딩 설정이 올바르게 적용됨
- [ ] Upsell 위젯이 Business 플랜에서만 표시됨
- [ ] 챗봇이 질문/답변을 정상 처리함
- [ ] 피드백 기능이 정상 동작함

### API 검증
- [ ] GET /api/guidebooks/[slug] - 200
- [ ] GET /api/guidebooks/[id]/branding - 200 or 404
- [ ] GET /api/guidebooks/[id]/upsell/items - 200
- [ ] POST /api/chatbot - 201
- [ ] PATCH /api/chatbot/feedback/[id] - 200

### 에러 처리
- [ ] 존재하지 않는 리소스 → 적절한 에러 메시지
- [ ] 네트워크 오류 → 재시도 안내
- [ ] 권한 없음 → 업그레이드 안내

### 성능
- [ ] 초기 로딩 3초 이내
- [ ] 챗봇 응답 3초 이내
- [ ] 이미지 lazy loading

### 접근성
- [ ] 키보드 네비게이션 가능
- [ ] 스크린 리더 호환
- [ ] 색상 대비 충족

### 반응형
- [ ] 모바일 (320px~)
- [ ] 태블릿 (768px~)
- [ ] 데스크톱 (1024px~)

---

## 테스트 완료 보고

### 테스트 결과 요약
```
총 테스트 항목: 6개 주요 검증 + 에러 케이스 + 성능 + 접근성
통과: ___개
실패: ___개
```

### 발견된 이슈
```
1. [이슈 제목]
   - 재현 방법:
   - 예상 동작:
   - 실제 동작:
   - 우선순위: High/Medium/Low

2. ...
```

### 개선 제안
```
1. [제안 사항]
   - 설명:
   - 기대 효과:
```

---

## 참고 자료
- **API 스펙**: `specs/domain/resources.yaml`
- **화면 스펙**: `specs/screens/guest-viewer.yaml`
- **자동화 테스트**: `tests/integration/guest-viewer.integration.test.ts`
- **커버리지 리포트**: `specs/coverage-report.yaml`
