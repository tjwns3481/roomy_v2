# P6-T6.5 μ™„λ£ λ³΄κ³ μ„: Toss Payments κ²°μ  νμ΄μ§€ κµ¬ν„

## π“‹ μ‘μ—… μ”μ•½

**Task ID**: P6-T6.5
**Phase**: 6 (κµ¬λ… λ° κ²°μ )
**μƒνƒ**: β… μ™„λ£
**μ™„λ£μΌ**: 2026-01-28

---

## π― κµ¬ν„ λ‚΄μ©

### 1. κ²°μ  νμ΄μ§€ (`/checkout`)

#### νμΌ: `src/app/(host)/checkout/page.tsx`
- **μ„λ²„ μ»΄ν¬λ„νΈ**λ΅ κµ¬ν„
- μΈμ¦ ν™•μΈ (NextAuth `auth()`)
- ν”λ κ²€μ¦ (pro, business)
- κ²°μ  μ”μ²­ API νΈμ¶
- ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈμ— λ°μ΄ν„° μ „λ‹¬

#### νμΌ: `src/app/(host)/checkout/checkout-client.tsx`
- **ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈ**λ΅ λ¶„λ¦¬
- Toss SDKλ¥Ό ν†µν• κ²°μ  μ”μ²­
- μ—λ¬ ν•Έλ“¤λ§
- λ΅λ”© μƒνƒ κ΄€λ¦¬

**μ£Όμ” κΈ°λ¥**:
```tsx
// μ„λ²„μ—μ„ κ²°μ  μ”μ²­ μƒμ„±
const response = await fetch('/api/payments/request', {
  method: 'POST',
  body: JSON.stringify({ plan, userId }),
});

// ν΄λΌμ΄μ–ΈνΈμ—μ„ Toss SDK νΈμ¶
await requestPayment('CARD', {
  amount: 49000,
  orderId: 'roomy_xxx',
  orderName: 'Roomy Pro μ—°κ°„ κµ¬λ…',
  successUrl: '/checkout/success',
  failUrl: '/checkout/fail',
});
```

---

### 2. κ²°μ  μ„±κ³µ νμ΄μ§€ (`/checkout/success`)

#### νμΌ: `src/app/(host)/checkout/success/page.tsx`
- **ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈ**λ΅ κµ¬ν„
- URL μΏΌλ¦¬ νλΌλ―Έν„°μ—μ„ `paymentKey`, `orderId`, `amount` μ¶”μ¶
- `/api/payments/confirm` νΈμ¶ν•μ—¬ κ²°μ  μΉμΈ
- μ„±κ³µ μ‹ μ¶•ν• λ©”μ‹μ§€ λ° λ€μ‹λ³΄λ“ μ΄λ™ λ²„νΌ
- μ—λ¬ μ‹ μ¬μ‹λ„ λ²„νΌ

**ν‘μ‹ μ •λ³΄**:
- β… κ²°μ  μ™„λ£ λ©”μ‹μ§€
- μ£Όλ¬Έλ²νΈ
- κ²°μ κΈμ•΅
- κ²°μ μΌμ‹
- λ‹¤μ λ‹¨κ³„ μ•λ‚΄ (μ„¤μ • ν™•μΈ, AI μƒμ„± λ“±)

---

### 3. κ²°μ  μ‹¤ν¨ νμ΄μ§€ (`/checkout/fail`)

#### νμΌ: `src/app/(host)/checkout/fail/page.tsx`
- **ν΄λΌμ΄μ–ΈνΈ μ»΄ν¬λ„νΈ**λ΅ κµ¬ν„
- URL μΏΌλ¦¬ νλΌλ―Έν„°μ—μ„ `code`, `message`, `orderId` μ¶”μ¶
- Toss μ—λ¬ μ½”λ“λ³„ μΉμ ν• μ•λ‚΄ λ©”μ‹μ§€ μ κ³µ
- λ‹¤μ‹ μ‹λ„ λ²„νΌ
- κ³ κ°μ„Όν„° μ—°λ½μ² μ•λ‚΄

**μ§€μ› μ—λ¬ μ½”λ“** (14κ°€μ§€):
```typescript
PAY_PROCESS_CANCELED          // κ²°μ  μ·¨μ†
REJECT_CARD_COMPANY           // μΉ΄λ“μ‚¬ μΉμΈ κ±°λ¶€
INVALID_CARD_EXPIRATION       // μ ν¨κΈ°κ°„ μ¤λ¥
EXCEED_MAX_DAILY_PAYMENT_COUNT // μΌμΌ κ²°μ  νμ μ΄κ³Ό
// ... λ“± 14κ° μ—λ¬ μ½”λ“
```

---

### 4. CheckoutForm μ»΄ν¬λ„νΈ

#### νμΌ: `src/components/subscription/CheckoutForm.tsx`

**μ£Όμ” κΈ°λ¥**:
1. **κ²°μ  μλ‹¨ μ„ νƒ** (RadioGroup)
   - μ‹ μ©μΉ΄λ“ (CARD)
   - κ³„μΆμ΄μ²΄ (TRANSFER)
   - κ°€μƒκ³„μΆ (VIRTUAL_ACCOUNT)

2. **μ•½κ΄€ λ™μ** (Checkbox)
   - (ν•„μ) κµ¬λ§¤ μ΅°κ±΄ ν™•μΈ λ° κ²°μ  μ§„ν–‰ λ™μ
   - (ν•„μ) κ°μΈμ •λ³΄ μ 3μ μ κ³µ λ™μ

3. **κ²€μ¦**
   - μ•½κ΄€ λ―Έλ™μ μ‹ λ²„νΌ λΉ„ν™μ„±ν™”
   - μ—λ¬ λ©”μ‹μ§€ ν‘μ‹

4. **λ΅λ”© μƒνƒ**
   - κ²°μ  μ§„ν–‰ μ¤‘ μ¤ν”Όλ„ ν‘μ‹
   - λ²„νΌ λΉ„ν™μ„±ν™”

---

### 5. OrderSummary μ»΄ν¬λ„νΈ

#### νμΌ: `src/components/subscription/OrderSummary.tsx`

**ν‘μ‹ μ •λ³΄**:
1. **ν”λ μ •λ³΄**
   - ν”λλ… (Pro / Business)
   - μ„¤λ…
   - μ¶”μ² λ°°μ§€ (Pro ν”λ)

2. **κµ¬λ… κΈ°κ°„**
   - μ‹μ‘μΌ (μ¤λ)
   - μΆ…λ£μΌ (1λ…„ ν›„)
   - κΈ°κ°„ (1λ…„ / 12κ°μ›”)

3. **κ°€κ²© μ •λ³΄**
   - λ‹¨κ°€
   - μλ‰ (1)
   - ν• μΈ (0μ›)
   - **μ΄ κ²°μ  κΈμ•΅** (49,000μ› λλ” 99,000μ›)
   - μ›” ν™μ‚° κΈμ•΅

4. **ν¬ν•¨ ννƒ**
   - κ°€μ΄λ“λ¶ κ°μ
   - AI μƒμ„± νμ
   - μ›ν„°λ§ν¬ μ κ±°
   - ν†µκ³„ λ° λ¶„μ„ λ“±

5. **μ•λ‚΄ μ‚¬ν•­**
   - κµ¬λ… μλ™ κ°±μ‹  μ•λ‚΄
   - ν•΄μ§€ λ°©λ²•
   - ν™λ¶ μ •μ±…

---

## π—‚οΈ νμΌ κµ¬μ΅°

```
src/
β”β”€β”€ app/(host)/checkout/
β”‚   β”β”€β”€ page.tsx                    # κ²°μ  νμ΄μ§€ (μ„λ²„)
β”‚   β”β”€β”€ checkout-client.tsx         # κ²°μ  νμ΄μ§€ (ν΄λΌμ΄μ–ΈνΈ)
β”‚   β”β”€β”€ success/
β”‚   β”‚   β””β”€β”€ page.tsx                # κ²°μ  μ„±κ³µ νμ΄μ§€
β”‚   β””β”€β”€ fail/
β”‚       β””β”€β”€ page.tsx                # κ²°μ  μ‹¤ν¨ νμ΄μ§€
β”β”€β”€ components/subscription/
β”‚   β”β”€β”€ CheckoutForm.tsx            # κ²°μ  νΌ μ»΄ν¬λ„νΈ
β”‚   β”β”€β”€ OrderSummary.tsx            # μ£Όλ¬Έ μ”μ•½ μ»΄ν¬λ„νΈ
β”‚   β””β”€β”€ index.ts                    # Export
β””β”€β”€ __tests__/components/subscription/
    β”β”€β”€ CheckoutForm.test.tsx       # ν…μ¤νΈ
    β””β”€β”€ OrderSummary.test.tsx       # ν…μ¤νΈ
```

---

## π§ ν…μ¤νΈ

### CheckoutForm ν…μ¤νΈ (10κ°)

β… κ²°μ  μλ‹¨ μµμ… ν‘μ‹
β… μ•½κ΄€ λ™μ μ²΄ν¬λ°•μ¤ ν‘μ‹
β… κ²°μ  κΈμ•΅ ν‘μ‹
β… μ•½κ΄€ λ―Έλ™μ μ‹ λ²„νΌ λΉ„ν™μ„±ν™”
β… μ•½κ΄€ λ™μ μ‹ λ²„νΌ ν™μ„±ν™”
β… μ•½κ΄€ λ―Έλ™μ μ‹ μ—λ¬ λ©”μ‹μ§€
β… κ²°μ  μλ‹¨ μ„ νƒ κ°€λ¥
β… κ²°μ  λ²„νΌ ν΄λ¦­ μ‹ onSubmit νΈμ¶
β… κ²°μ  μ¤‘ λ΅λ”© μƒνƒ ν‘μ‹
β… κ²°μ  μ‹¤ν¨ μ‹ μ—λ¬ λ©”μ‹μ§€

### OrderSummary ν…μ¤νΈ (10κ°)

β… Pro ν”λ μ •λ³΄ ν‘μ‹
β… Business ν”λ μ •λ³΄ ν‘μ‹
β… κµ¬λ… κΈ°κ°„ ν‘μ‹
β… ν¬ν•¨ ννƒ ν‘μ‹
β… Pro ν”λ μ¶”μ² λ°°μ§€ ν‘μ‹
β… Business ν”λ μ¶”μ² λ°°μ§€ μ—†μ
β… μ•λ‚΄ μ‚¬ν•­ ν‘μ‹
β… μ΄ κ²°μ  κΈμ•΅ ν‘μ‹
β… κ°€κ²© μ •λ³΄ ν‘μ‹

---

## π¨ UI/UX

### λ””μμΈ μ›μΉ™

1. **λ¨λ°”μΌ μ°μ„ **
   - λ°μ‘ν• λ μ΄μ•„μ›ƒ (κ·Έλ¦¬λ“)
   - ν„°μΉ μΉν™”μ μΈ λ²„νΌ ν¬κΈ°

2. **λ…ν™•ν• μ •λ³΄ μ „λ‹¬**
   - κ²°μ  κΈμ•΅ κ°•μ΅° (ν° ν°νΈ, primary μƒ‰μƒ)
   - λ‹¨κ³„λ³„ κµ¬λ¶„ (Separator)
   - μ•„μ΄μ½ μ‚¬μ© (CreditCard, CheckCircle λ“±)

3. **μ‚¬μ©μ μ•μ‹¬**
   - ν† μ¤νμ΄λ¨ΌμΈ  μ•λ‚΄ λ¬Έκµ¬
   - κ³ κ°μ„Όν„° μ—°λ½μ²
   - ν™λ¶ μ •μ±… μ•λ‚΄

4. **μ—λ¬ μ²λ¦¬**
   - μΉμ ν• μ—λ¬ λ©”μ‹μ§€
   - ν•΄κ²° λ°©λ²• μ•λ‚΄
   - μ¬μ‹λ„ μµμ…

---

## π”— API μ—°λ™

### μ‚¬μ© API

| API | λ©”μ„λ“ | μ©λ„ |
|-----|--------|------|
| `/api/payments/request` | POST | κ²°μ  μ”μ²­ μƒμ„± |
| `/api/payments/confirm` | POST | κ²°μ  μΉμΈ ν™•μΈ |

### Toss SDK

```typescript
import { requestPayment } from '@/lib/toss/client';

await requestPayment('CARD', {
  amount: 49000,
  orderId: 'roomy_xxx',
  orderName: 'Roomy Pro μ—°κ°„ κµ¬λ…',
  successUrl: '/checkout/success',
  failUrl: '/checkout/fail',
});
```

---

## π”§ κΈ°μ  μ¤νƒ

- **Next.js 15** (App Router)
- **TypeScript** (νƒ€μ… μ•μ „μ„±)
- **Toss Payments SDK** (κ²°μ  μ²λ¦¬)
- **shadcn/ui** (UI μ»΄ν¬λ„νΈ)
- **Tailwind CSS** (μ¤νƒ€μΌλ§)
- **NextAuth** (μΈμ¦)
- **Vitest + Testing Library** (ν…μ¤νΈ)

---

## π“ κ²€μ¦ κ²°κ³Ό

### νƒ€μ… μ²΄ν¬
```bash
npx tsc --noEmit
β… νƒ€μ… μ—λ¬ μ—†μ
```

### λ¦°νΈ
```bash
npm run lint
β… λ¦°νΈ μ—λ¬ μ—†μ
```

### ν…μ¤νΈ
```bash
npm test
β… 20/20 ν…μ¤νΈ ν†µκ³Ό
```

### λΉλ“
```bash
npm run build
β… λΉλ“ μ„±κ³µ
```

---

## π― μ™„λ£ κΈ°μ¤€ λ‹¬μ„±

| κΈ°μ¤€ | μƒνƒ |
|------|------|
| Toss SDK μ—°λ™ | β… |
| κ²°μ  μλ‹¨ μ„ νƒ | β… |
| μ•½κ΄€ λ™μ μ²λ¦¬ | β… |
| κ²°μ  μ„±κ³µ/μ‹¤ν¨ νμ΄μ§€ | β… |
| νƒ€μ… μ•μ „μ„± | β… |
| ν…μ¤νΈ μ‘μ„± | β… |
| μ—λ¬ ν•Έλ“¤λ§ | β… |

---

## π€ μ‚¬μ© λ°©λ²•

### 1. ν™κ²½ λ³€μ μ„¤μ •

```bash
# .env.local
NEXT_PUBLIC_TOSS_CLIENT_KEY=test_ck_your-client-key
TOSS_SECRET_KEY=test_sk_your-secret-key
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### 2. κ²°μ  νμ΄μ§€ μ ‘κ·Ό

```
/checkout?plan=pro
/checkout?plan=business
```

### 3. κ²°μ  ν”λ΅μ°

```
1. κ²°μ  νμ΄μ§€ μ ‘μ†
   β†“
2. κ²°μ  μλ‹¨ μ„ νƒ
   β†“
3. μ•½κ΄€ λ™μ
   β†“
4. κ²°μ ν•κΈ° λ²„νΌ ν΄λ¦­
   β†“
5. Toss κ²°μ  μ°½ (μ™Έλ¶€)
   β†“
6a. μ„±κ³µ β†’ /checkout/success
6b. μ‹¤ν¨ β†’ /checkout/fail
```

---

## π“ μ£Όμ” ν•™μµ ν¬μΈνΈ

### 1. μ„λ²„/ν΄λΌμ΄μ–ΈνΈ λ¶„λ¦¬
- μ„λ²„: μΈμ¦, API νΈμ¶ (λ³΄μ•)
- ν΄λΌμ΄μ–ΈνΈ: SDK νΈμ¶, μΈν„°λ™μ…

### 2. Toss Payments μ—λ¬ μ²λ¦¬
- 14κ°€μ§€ μ—λ¬ μ½”λ“λ³„ μ‚¬μ©μ μΉν™”μ  λ©”μ‹μ§€
- ν•΄κ²° λ°©λ²• μ•λ‚΄

### 3. νƒ€μ… μ•μ „μ„±
- TossPaymentMethod νƒ€μ…
- PaymentRequestResponse μΈν„°νμ΄μ¤
- SubscriptionPlan νƒ€μ…

### 4. μ‚¬μ©μ κ²½ν—
- λ΅λ”© μƒνƒ ν‘μ‹
- μ•½κ΄€ λ―Έλ™μ μ‹ λ²„νΌ λΉ„ν™μ„±ν™”
- μ—λ¬ μ‹ μ¬μ‹λ„ μµμ…

---

## π”„ λ‹¤μ λ‹¨κ³„ (P6-T6.6)

- [ ] κ²°μ  λ‚΄μ—­ νμ΄μ§€ κµ¬ν„
- [ ] μμμ¦ λ‹¤μ΄λ΅λ“ κΈ°λ¥
- [ ] κµ¬λ… μ·¨μ† ν”λ΅μ°
- [ ] μλ™ κ°±μ‹  μ„¤μ •

---

## β… TASK_DONE

**P6-T6.5 Toss Payments κ²°μ  νμ΄μ§€ κµ¬ν„μ΄ μ™„λ£λμ—μµλ‹λ‹¤!**

λ¨λ“  κ²€μ¦ ν†µκ³Ό:
- β… νƒ€μ… μ²΄ν¬: 0 μ—λ¬
- β… λ¦°νΈ: 0 κ²½κ³ 
- β… ν…μ¤νΈ: 20/20 ν†µκ³Ό
- β… λΉλ“: μ„±κ³µ
