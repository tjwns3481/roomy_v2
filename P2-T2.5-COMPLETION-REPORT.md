# P2-T2.5 완료 리포트

## 📋 태스크 정보
- **Phase**: 2
- **태스크 ID**: P2-T2.5
- **태스크명**: 게스트 뷰 하단 네비게이션 바 구현
- **완료일**: 2026-01-28

---

## ✅ 구현 내용

### 1. BottomNav 컴포넌트 생성
**파일**: `src/components/guest/BottomNav.tsx`

#### 주요 기능
- ✅ 5가지 네비게이션 항목 (홈, 지도, 정보, 규칙, 문의)
- ✅ 클릭 시 해당 섹션으로 부드러운 스크롤
- ✅ Intersection Observer로 현재 섹션 감지 및 하이라이트
- ✅ 블록 존재 여부에 따라 네비 항목 동적 표시/숨김
- ✅ iOS safe-area-inset-bottom 지원
- ✅ 44×44px 최소 터치 타겟 (실제 64×64px 적용)
- ✅ 모바일 전용 표시 (md:hidden)
- ✅ 배경 블러 효과 (backdrop-blur-lg)

#### 네비게이션 항목 매핑
```typescript
| 아이콘 | 레이블 | 섹션 ID | 블록 타입 | 표시 조건 |
|--------|--------|---------|-----------|----------|
| Home | 홈 | top | - | 항상 표시 |
| MapPin | 지도 | block-map | map | map 블록 존재 시 |
| Info | 정보 | block-quickInfo | quickInfo | quickInfo 블록 존재 시 |
| List | 규칙 | block-rules | rules | rules 블록 존재 시 |
| MessageCircle | 문의 | contact | - | 항상 표시 |
```

### 2. 게스트 페이지 통합
**파일**: `src/app/(guest)/g/[slug]/page.tsx`

#### 변경 사항
- ✅ 각 블록에 `id="block-{type}"` 추가
- ✅ `scroll-mt-20` 클래스로 스크롤 오프셋 적용
- ✅ `<div id="top">` 앵커 추가 (페이지 최상단)
- ✅ `<section id="contact">` 문의 섹션 추가
- ✅ `pb-20 md:pb-0` 클래스로 하단 네비 여백 확보
- ✅ `availableBlockTypes` 추출 후 BottomNav에 전달

### 3. 테스트 작성
**파일**: `src/__tests__/components/guest/BottomNav.test.tsx`

#### 테스트 시나리오
- ✅ **렌더링 테스트** (4개)
  - 모든 블록 존재 시 5개 네비 렌더링
  - 블록 없을 때 홈/문의만 렌더링
  - 일부 블록만 있을 때 해당 네비만 렌더링
- ✅ **스크롤 연동 테스트** (2개)
  - 홈 버튼: `window.scrollTo({ top: 0, behavior: 'smooth' })`
  - 기타 버튼: `scrollIntoView({ behavior: 'smooth', block: 'start' })`
- ✅ **접근성 테스트** (3개)
  - nav 요소 aria-label
  - 모든 버튼 aria-label
  - 최소 터치 타겟 크기
- ✅ **반응형 테스트** (2개)
  - 모바일 전용 표시 (md:hidden)
  - iOS safe-area 지원

---

## 🎯 완료 기준 달성

| 기준 | 상태 | 비고 |
|------|------|------|
| 하단 네비게이션 바 렌더링 | ✅ | 5개 항목 (홈, 지도, 정보, 규칙, 문의) |
| 클릭 시 해당 섹션으로 스크롤 | ✅ | scrollIntoView + window.scrollTo |
| 현재 섹션 하이라이트 | ✅ | Intersection Observer 활용 |
| iOS safe area 지원 | ✅ | env(safe-area-inset-bottom) |
| 블록 존재 여부 체크 | ✅ | availableBlocks props로 동적 필터링 |
| 모바일 전용 표시 | ✅ | md:hidden 클래스 |
| 44×44px 최소 터치 타겟 | ✅ | 64×64px 적용 |
| 배경 블러 효과 | ✅ | backdrop-blur-lg |

---

## 🔍 검증 결과

### 1. TypeScript 타입 체크
```bash
npx tsc --noEmit
```
✅ **통과**: 타입 에러 없음

### 2. ESLint 검사
```bash
npm run lint
```
✅ **통과**: 린트 에러 없음

### 3. 테스트 실행
```bash
npm test -- src/__tests__/components/guest/BottomNav.test.tsx
```
✅ **통과**: 11개 테스트 모두 통과

### 4. 빌드 확인
```bash
npm run build
```
✅ **통과**: 빌드 성공

### 5. 파일 구조
```
src/
├── components/
│   └── guest/
│       └── BottomNav.tsx               ✅ 생성
├── app/
│   └── (guest)/
│       └── g/
│           └── [slug]/
│               └── page.tsx            ✅ 수정
└── __tests__/
    └── components/
        └── guest/
            └── BottomNav.test.tsx      ✅ 생성
```

---

## 🧪 테스트 시나리오

### 시나리오 1: 전체 블록 가이드북
1. 브라우저에서 모든 블록이 있는 가이드북 접근
2. 하단에 5개 네비 항목 표시
3. 각 버튼 클릭 시 해당 섹션으로 스크롤
4. 스크롤 시 현재 섹션 자동 하이라이트

**예상 결과**: 모든 네비 항목 정상 동작

### 시나리오 2: 부분 블록 가이드북
1. quickInfo, rules 블록만 있는 가이드북 접근
2. 하단에 4개 네비 항목 표시 (홈, 정보, 규칙, 문의)
3. 지도 네비 항목 숨김

**예상 결과**: 존재하는 블록의 네비만 표시

### 시나리오 3: 빈 가이드북
1. 블록이 없는 가이드북 접근
2. 하단에 2개 네비 항목만 표시 (홈, 문의)

**예상 결과**: 기본 네비(홈, 문의)만 표시

### 시나리오 4: iOS 디바이스
1. iPhone에서 가이드북 접근
2. 하단 네비가 safe-area를 존중
3. 홈 버튼 영역이 네비를 가리지 않음

**예상 결과**: iOS 하단 여백 정상 적용

### 시나리오 5: 데스크톱 접근
1. 데스크톱 브라우저에서 접근
2. 하단 네비 숨김 (md:hidden)

**예상 결과**: 네비 미표시

---

## 📊 기술 스택

| 항목 | 기술 |
|------|------|
| UI Library | lucide-react (아이콘) |
| 스크롤 API | scrollIntoView(), window.scrollTo() |
| 섹션 감지 | Intersection Observer |
| 스타일링 | Tailwind CSS, cn() 유틸리티 |
| 반응형 | Tailwind Breakpoints (md:) |
| iOS 지원 | env(safe-area-inset-bottom) |
| 접근성 | ARIA labels, 최소 터치 타겟 |

---

## 🎨 디자인 토큰

### 색상
- **기본 텍스트**: `text-gray-600`
- **활성 텍스트**: `text-blue-600`
- **활성 배경**: `bg-blue-50`
- **호버 배경**: `bg-gray-100`
- **네비 배경**: `bg-white/80` (80% 불투명도)
- **테두리**: `border-gray-200`

### 간격
- **네비 높이**: `py-2` (8px 상하)
- **아이템 패딩**: `px-3 py-2` (12px 좌우, 8px 상하)
- **아이콘-라벨 간격**: `mb-1` (4px)
- **아이템 간격**: `justify-around` (균등 배치)

### 애니메이션
- **전환**: `transition-all duration-200`
- **클릭**: `active:scale-95` (5% 축소)
- **활성 아이콘**: `scale-110` (10% 확대)

### 터치 타겟
- **최소 크기**: `min-w-[64px] min-h-[64px]`
- **권장 기준**: Apple HIG 44×44px 초과

---

## 🔗 연관 파일

| 파일 | 역할 |
|------|------|
| `src/types/guidebook.ts` | BlockType 타입 정의 |
| `src/lib/utils.ts` | cn() 유틸리티 함수 |
| `src/app/(guest)/layout.tsx` | 게스트 레이아웃 |
| `docs/planning/06-tasks.md` | P2-T2.5 태스크 명세 |

---

## 🚀 다음 단계 (P2-T2.6)

**태스크**: 테마 시스템 (Guest) 구현

### 필요 작업
1. `src/lib/theme/presets.ts` 생성
   - Modern, Cozy, Minimal, Nature, Luxury 프리셋
2. `src/components/guest/ThemeProvider.tsx` 생성
   - CSS Variables 주입
3. 가이드북 테마 적용
   - primary_color, secondary_color 반영

---

## 📝 Lessons Learned

### 2026-01-28: P2-T2.5 하단 네비게이션 구현

**상황**: 모바일 게스트 뷰 하단 네비게이션 + Intersection Observer + 동적 필터링

**배운 점**:
1. **Intersection Observer 활용**: 스크롤 이벤트 대신 IO로 성능 최적화
   - `rootMargin: '-50% 0px -50% 0px'`로 화면 중앙 기준 감지
2. **동적 네비 필터링**: props로 블록 존재 여부 전달하여 불필요한 네비 숨김
   - 사용자 경험 개선 (비어있는 섹션으로 이동 방지)
3. **iOS safe-area 대응**: `env(safe-area-inset-bottom)` 사용
   - 홈 버튼 영역과 겹침 방지
4. **접근성 고려**: `aria-label`, `aria-current` 속성으로 스크린 리더 지원
   - 최소 터치 타겟 64×64px 적용 (Apple HIG 권장)
5. **scroll-mt-20**: 고정 헤더/네비 있을 때 스크롤 오프셋 클래스로 간편 처리

**교훈**: 모바일 UI는 터치 타겟 크기, iOS 안전 영역, 접근성을 필수로 고려해야 함

**안티패턴 방지**:
- ❌ 스크롤 이벤트 리스너 → ✅ Intersection Observer (성능)
- ❌ 고정 네비 항목 → ✅ 동적 필터링 (UX)
- ❌ 하드코딩된 패딩 → ✅ safe-area-inset (iOS 대응)

---

## ✅ TASK_DONE

검증 결과:
- ✅ TypeScript 타입 체크: 통과
- ✅ ESLint: 통과
- ✅ 테스트: 11/11 통과
- ✅ 빌드: 성공
- ✅ 파일 생성: 2개 (BottomNav.tsx, BottomNav.test.tsx), 1개 수정 (page.tsx)
- ✅ 완료 기준: 8/8 달성
