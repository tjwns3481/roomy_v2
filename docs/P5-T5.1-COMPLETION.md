# P5-T5.1: Setup Wizard CLI 스크립트 - 완료 보고서

## 작업 개요

- **Task ID**: P5-T5.1
- **담당**: backend-specialist
- **Phase**: 5 (배포 및 초기 설정)
- **Worktree**: worktree/phase-5-deploy

## 구현 내용

### 1. 핵심 모듈 (scripts/setup/index.ts)

재사용 가능한 핵심 기능을 모듈화:

- `testSupabaseConnection()` - Supabase 연결 테스트
- `createEnvFile()` - .env.local 파일 생성
- `createSiteConfig()` - config/site.config.ts 생성
- `updateGitignore()` - .gitignore 업데이트
- `isValidUrl()` - URL 유효성 검증
- `isValidEmail()` - 이메일 유효성 검증
- `isSetupComplete()` - 설정 완료 여부 확인

### 2. 인터랙티브 CLI 위저드 (scripts/setup-wizard.ts)

`prompts` 패키지를 사용한 대화형 설정 프로세스:

#### Step 1: Supabase 설정
- Supabase Project URL 입력
- Supabase Anon Key 입력
- Service Role Key 입력 (선택사항)
- 연결 테스트 자동 실행 및 검증

#### Step 2: Toss Payments 설정 (선택사항)
- Client Key 입력
- Secret Key 입력

#### Step 3: 사이트 기본 정보
- 상점명 입력
- 사이트 URL 입력 (URL 형식 검증)
- 관리자 이메일 입력 (이메일 형식 검증)
- 사이트 설명 입력 (선택사항)

#### Step 4: 설정 파일 생성
- `.env.local` 파일 생성 (환경 변수)
- `config/site.config.ts` 파일 생성 (사이트 설정)
- `.gitignore` 업데이트 확인

### 3. 생성되는 파일

#### .env.local
```bash
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=https://example.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-key

# Toss Payments Configuration (Optional)
TOSS_CLIENT_KEY=test_ck_yourkey
TOSS_SECRET_KEY=test_sk_yourkey

# Application Configuration
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

#### config/site.config.ts
```typescript
export const siteConfig = {
  name: "Vibe Store",
  url: "http://localhost:3000",
  adminEmail: "admin@example.com",
  description: "Vibe Store - 디지털 상품 쇼핑몰",
  links: {
    youtube: "",
    github: "",
    twitter: "",
  },
  metadata: {
    title: "Vibe Store",
    description: "Vibe Store - 디지털 상품 쇼핑몰",
    keywords: ["디지털 상품", "쇼핑몰", "다운로드"],
  },
} as const;
```

### 4. 설치된 패키지

```json
{
  "devDependencies": {
    "prompts": "^2.4.2",
    "@types/prompts": "^2.4.9",
    "tsx": "^4.21.0"
  }
}
```

### 5. package.json 스크립트

```json
{
  "scripts": {
    "setup": "tsx scripts/setup-wizard.ts"
  }
}
```

## 테스트

### 테스트 파일: tests/scripts/setup.test.ts

11개의 단위 테스트로 모든 핵심 기능 검증:

1. `createEnvFile` - 모든 필드 포함
2. `createEnvFile` - 선택 필드 주석 처리
3. `createSiteConfig` - 기본 설정 생성
4. `createSiteConfig` - 기본 설명 사용
5. `isValidUrl` - 유효한 URL 검증
6. `isValidUrl` - 잘못된 URL 거부
7. `isValidEmail` - 유효한 이메일 검증
8. `isValidEmail` - 잘못된 이메일 거부
9. `isSetupComplete` - 설정 미완료 감지
10. `isSetupComplete` - 설정 완료 감지
11. `isSetupComplete` - 부분 설정 감지

### 테스트 결과

```
✅ Test Files  1 passed (1)
✅ Tests       11 passed (11)
⏱️  Duration   1.19s
```

## 사용법

### 초기 설정 실행

```bash
npm run setup
```

### 재설정

이미 설정된 경우 덮어쓰기 여부를 확인하는 프롬프트가 표시됩니다.

```bash
npm run setup
# → 이미 설정이 완료되었습니다. 다시 설정하시겠습니까? (y/N)
```

## 보안

- `.env.local` 파일은 `.gitignore`에 포함되어 버전 관리에서 제외
- 민감한 정보는 환경 변수로만 관리
- 공개 설정은 `config/site.config.ts`로 분리

## 문서

### scripts/README.md
설정 마법사의 사용법과 구조를 설명하는 문서 작성

### .env.example
환경 변수 템플릿 제공

### config/site.config.example.ts
사이트 설정 예시 제공

## AC (Acceptance Criteria) 충족

✅ **인터랙티브 CLI 위저드**
- prompts 패키지를 사용한 대화형 인터페이스 구현

✅ **Supabase URL 및 ANON_KEY 입력**
- Step 1에서 입력 및 연결 테스트 자동 실행

✅ **Toss Payments 키 입력 (선택)**
- Step 2에서 선택적으로 입력 가능

✅ **사이트 기본 정보 입력**
- Step 3에서 상점명, URL, 관리자 이메일, 설명 입력

✅ **.env.local 생성**
- 민감 정보를 포함한 환경 변수 파일 생성
- gitignore됨

✅ **config/site.config.ts 생성**
- 공개 설정 파일 생성

✅ **npm run setup 명령으로 실행**
- package.json에 스크립트 추가 완료

## 파일 목록

```
worktree/phase-5-deploy/
├── scripts/
│   ├── setup-wizard.ts          # 메인 위저드 스크립트
│   ├── setup/
│   │   └── index.ts             # 핵심 기능 모듈
│   └── README.md                # 문서
├── tests/
│   └── scripts/
│       └── setup.test.ts        # 단위 테스트
├── config/
│   └── site.config.example.ts   # 설정 예시
├── .env.example                 # 환경 변수 템플릿
├── package.json                 # setup 스크립트 추가
└── docs/
    └── P5-T5.1-COMPLETION.md    # 이 문서
```

## 다음 단계

P5-T5.1이 완료되었으므로 다음 태스크로 진행 가능:

- **P5-T5.2**: DB 자동 마이그레이션 스크립트 (의존: T5.1)
- **P5-T5.3**: Setup Wizard Web UI (의존: T5.1)
- **P5-T5.4**: 설정 API 및 보안 저장소 (의존: T5.1)

## 품질 보증

- ✅ 모든 단위 테스트 통과 (11/11)
- ✅ TypeScript 컴파일 에러 없음
- ✅ ESLint 검사 통과
- ✅ 문서화 완료
- ✅ 보안 고려사항 충족
- ✅ 사용자 경험 최적화 (유효성 검증, 에러 처리)

## 작업 완료일

2026-01-25

## 작업자

backend-specialist (task-executor via Claude Code)
